var request = require('request');

var apiCall = function(obj, callback, fullBody){
  request.post('http://text-processing.com/api/sentiment/', {form:{text: obj}}, function(err, body){
    var sentiment = body.body;
    if (!fullBody){
      callback(JSON.parse(sentiment)['label']);
    }
    else{
      callback(JSON.parse(sentiment));
    }
  });
}

module.exports = function(obj, callback, fullBody){
  // set default of fullBody response false
  if  (fullBody !== true){
    fullBody = false;
  }

  var arrayFunc = function(obj, index, callback, fullBody){
    apiCall(obj[index], function(senti){
      obj[index] = senti;
      index++;
      if (index == obj.length){
        callback(obj);
      }
      else{
        arrayFunc(obj,index,callback, fullBody);
      }
    }, fullBody)
  };


  if (obj instanceof Array){
    var index = 0;
    arrayFunc(obj, index, callback, fullBody);
  }

  else if (typeof obj === 'string'){
    apiCall(obj,callback, fullBody);
  }
}

